\begin{Verbatim}[label=\makebox{\href{https://github.com/unipi-physics-labs/lab1-sheets/tree/main/snippy/dad_palla.py}{https://github.com/.../dad\_palla.py}},commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{wave}

\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{numpy}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{np}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{matplotlib}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{pyplot} \PY{k}{as} \PY{n}{plt}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{optimize}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{curve\PYZus{}fit}

\PY{n}{file\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{macro/data/bouncing\PYZus{}ball3.wav}\PY{l+s+s1}{\PYZsq{}}
\PY{c+c1}{\PYZsh{} Apertura del file audio, vedi https://docs.python.org/3/library/wave.html}
\PY{n}{stream} \PY{o}{=} \PY{n}{wave}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{n}{file\PYZus{}path}\PY{p}{)}
\PY{n}{signal} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{frombuffer}\PY{p}{(}\PY{n}{stream}\PY{o}{.}\PY{n}{readframes}\PY{p}{(}\PY{n}{stream}\PY{o}{.}\PY{n}{getnframes}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{int16}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Importante: se il file originale e` stereo dobbiamo prendere solo uno dei canali.}
\PY{k}{if} \PY{n}{stream}\PY{o}{.}\PY{n}{getnchannels}\PY{p}{(}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{2}\PY{p}{:}
    \PY{n}{signal} \PY{o}{=} \PY{n}{signal}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
\PY{c+c1}{\PYZsh{} L\PYZsq{}unica cosa che ci manca e` l\PYZsq{}array dei tempi corrispondenti ai singoli campioni.}
\PY{n}{t} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{signal}\PY{p}{)}\PY{p}{)} \PY{o}{/} \PY{n}{stream}\PY{o}{.}\PY{n}{getframerate}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} A questo punto siamo pronti per analizzare il tracciato audio. Una volta}
\PY{c+c1}{\PYZsh{} messi i dati in un grafico di matplotlib possiamo utilizzare lo strumento}
\PY{c+c1}{\PYZsh{} zoom ed il mouse per misurare i tempi di rimbalzo della pallina.}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Rimbalzi pallina}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{signal}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Tempo [s]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{audio\PYZus{}rimbalzi.pdf}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Supponiamo di aver preso a mano questa serie di tempi di rimbalzo.}
\PY{n}{t} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.01961451}\PY{p}{,} \PY{l+m+mf}{0.69562358}\PY{p}{,} \PY{l+m+mf}{1.23981859}\PY{p}{,} \PY{l+m+mf}{1.679161}\PY{p}{,} \PY{l+m+mf}{2.04113379}\PY{p}{,} \PY{l+m+mf}{2.33979592}\PY{p}{]}
\PY{c+c1}{\PYZsh{} Cercate di stimare ragionevolmente gli errori...}
\PY{n}{sigma\PYZus{}t} \PY{o}{=} \PY{l+m+mf}{0.005}
\PY{c+c1}{\PYZsh{} Calcolo delle differenze di tempo.}
\PY{n}{dt} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{t}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Creazione dell\PYZsq{}array con gli indici dei rimbalzi.}
\PY{n}{n} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{dt}\PY{p}{)}\PY{p}{)} \PY{o}{+} \PY{l+m+mf}{1.}
\PY{c+c1}{\PYZsh{} Calcolo dell\PYZsq{}altezza massima e propagazione degli errori.}
\PY{n}{h} \PY{o}{=} \PY{l+m+mf}{9.81} \PY{o}{*} \PY{p}{(}\PY{n}{dt}\PY{o}{*}\PY{o}{*}\PY{l+m+mf}{2.}\PY{p}{)} \PY{o}{/} \PY{l+m+mf}{8.0}
\PY{n}{dh} \PY{o}{=} \PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{l+m+mf}{2.0}\PY{p}{)} \PY{o}{*} \PY{n}{h} \PY{o}{*} \PY{n}{sigma\PYZus{}t} \PY{o}{/} \PY{n}{dt}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{expo}\PY{p}{(}\PY{n}{n}\PY{p}{,} \PY{n}{h0}\PY{p}{,} \PY{n}{gamma}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Modello di fit.}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{k}{return} \PY{n}{h0} \PY{o}{*} \PY{n}{gamma}\PY{o}{*}\PY{o}{*}\PY{n}{n}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Altezza dei rimbalzi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{n}\PY{p}{,} \PY{n}{h}\PY{p}{,} \PY{n}{dh}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{popt}\PY{p}{,} \PY{n}{pcov} \PY{o}{=} \PY{n}{curve\PYZus{}fit}\PY{p}{(}\PY{n}{expo}\PY{p}{,} \PY{n}{n}\PY{p}{,} \PY{n}{h}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{dh}\PY{p}{)}
\PY{n}{h0\PYZus{}hat}\PY{p}{,} \PY{n}{gamma\PYZus{}hat} \PY{o}{=} \PY{n}{popt}
\PY{n}{sigma\PYZus{}h0}\PY{p}{,} \PY{n}{sigma\PYZus{}gamma} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{pcov}\PY{o}{.}\PY{n}{diagonal}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{h0\PYZus{}hat}\PY{p}{,} \PY{n}{sigma\PYZus{}h0}\PY{p}{,} \PY{n}{gamma\PYZus{}hat}\PY{p}{,} \PY{n}{sigma\PYZus{}gamma}\PY{p}{)}
\PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mf}{6.0}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{expo}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{h0\PYZus{}hat}\PY{p}{,} \PY{n}{gamma\PYZus{}hat}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{yscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{both}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dashed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Rimbalzo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Altezza massima [m]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{altezza\PYZus{}rimbalzi.pdf}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
